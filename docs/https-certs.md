> **Note:** This README was generated by ChatGPT.

# Using `mkcert` on Raspberry Pi to Serve HTTPS

This guide explains how to install and use **mkcert** on a Raspberry Pi to generate locally trusted HTTPS certificates. It also includes instructions to trust the generated Root Certificate Authority (CA) on **Chrome (macOS)** and **Safari (iOS)**.

---

## Overview

`mkcert` is a simple tool that creates locally trusted development certificates.

It:

- Creates a local Certificate Authority (CA)
- Installs it into the system trust store
- Uses it to generate SSL certificates for local development

This is perfect for development on a Raspberry Pi using HTTPS (for example, when hosting a local web server, dashboard, or IoT project).

---

## 1. Installing `mkcert` on Raspberry Pi

### Requirements

- Raspberry Pi running **Raspberry Pi OS** (Debian-based)
- `mkcert` available from APT repos
- `libnss3-tools`

### Step 1 — Install `mkcert` and dependencies

Run:

    sudo apt update
    sudo apt install mkcert libnss3-tools -y

### Step 2 — Create and install the local CA

Run:

    mkcert -install

You should see output like:

    The local CA is now installed in the system trust store.

`mkcert` will create:

- `rootCA.pem`
- `rootCA-key.pem`

Location (on the Pi):

    ~/.local/share/mkcert

You will need `rootCA.pem` to trust certificates on other devices (Mac, iPhone, etc.).

---

## 2. Generate HTTPS Certificates for Your Local Server

### Step 1 — Navigate to your project directory

    cd /path/to/your/project

### Step 2 — Generate certificates

Replace `myserver.local` and `192.168.1.42` with your Pi’s hostname/IP:

    mkcert myserver.local 192.168.1.42 localhost

This will output files like:

- `myserver.local+2.pem` (certificate)
- `myserver.local+2-key.pem` (private key)

### Step 3 — Use the certificates in your HTTPS server (example: Node.js / Express)

Example `server.js`:

    const fs = require('fs');
    const https = require('https');
    const express = require('express');

    const app = express();

    const options = {
      key: fs.readFileSync('./myserver.local+2-key.pem'),
      cert: fs.readFileSync('./myserver.local+2.pem'),
    };

    app.get('/', (req, res) => {
      res.send('Hello from Raspberry Pi over HTTPS!');
    });

    https.createServer(options, app).listen(443, () => {
      console.log('HTTPS server running on port 443');
    });

Then run:

    node server.js

You should now have an HTTPS server on your Raspberry Pi listening on port 443.

---

## 3. Trusting the Root CA on macOS (Chrome & Safari)

To avoid HTTPS warnings on your Mac, you must trust the `mkcert` root CA in the macOS keychain.

### Step 1 — Copy the CA to your Mac

On the Raspberry Pi, run:

    scp ~/.local/share/mkcert/rootCA.pem your-mac-username@your-mac-ip:~/Downloads/

(Replace `your-mac-username` and `your-mac-ip` accordingly.)

### Step 2 — Add the certificate to macOS Keychain

On your Mac:

1. Open **Keychain Access** (Applications → Utilities → Keychain Access).
2. In the left sidebar, select **System** keychain (not “login”).
3. Drag `rootCA.pem` from `~/Downloads` into the **System** keychain.
4. Double-click the imported certificate (it will likely be named something like “mkcert development CA”).
5. Expand the **Trust** section.
6. Set **“When using this certificate”** to **“Always Trust”**.
7. Close the window; macOS will prompt for your password. Enter it to save the changes.
8. Restart **Chrome** and **Safari**.

### Browsers affected

- **Chrome (macOS)** — uses the macOS system trust store
- **Safari (macOS)** — uses the same trust store

After this, both browsers should trust certificates issued by your Raspberry Pi’s `mkcert` CA.

---

## 4. Trusting the Root CA on iOS (Safari)

iOS requires installing the CA as a profile and then explicitly enabling trust.

### Step 1 — Transfer `rootCA.pem` to your iPhone or iPad

You can use any of these options:

- **AirDrop** from your Mac to your iOS device.
- **Email** the file to yourself and open it on your iOS device.
- Temporarily serve the file from the Pi and download it via Safari.

For example, to serve it temporarily from the Pi:

1. On the Pi:

   cd ~/.local/share/mkcert
   python3 -m http.server 8000

2. On your iOS device, open Safari and go to:

   http://<pi-ip-address>:8000/

3. Tap `rootCA.pem` to download it.

### Step 2 — Install the downloaded profile

On your iOS device:

1. When you tap `rootCA.pem`, iOS will prompt to allow downloading a configuration profile. Tap **Allow**.
2. Open **Settings**.
3. You should see **Profile Downloaded** near the top. If not, go to:

   Settings → General → VPN & Device Management

4. Tap the downloaded profile (it will reference the mkcert root CA).
5. Tap **Install** in the top right.
6. Enter your passcode if prompted.
7. Tap **Install** again to confirm.

### Step 3 — Trust the root certificate

This step is required for iOS to fully trust the CA for SSL:

1. Open:

   Settings → General → About → Certificate Trust Settings

2. Under **“Enable Full Trust For Root Certificates”**, look for the mkcert root CA you just installed.
3. Toggle it **ON**.
4. Confirm when asked.

After this, **Safari on iOS** will trust certificates issued by the mkcert CA running on your Raspberry Pi.

---

## 5. Testing the Setup

From your Mac or iOS device, try visiting your Pi over HTTPS.

### Using a hostname

If you set up DNS or a hosts file entry for `myserver.local`:

    https://myserver.local

Make sure your Mac / iOS device can resolve this hostname to the Pi’s IP.

### Using the local IP

Alternatively, you can use the IP you included in the certificate (for example, `192.168.1.42`):

    https://192.168.1.42

You should see:

- A **secure padlock** (no red warnings).
- No “Your connection is not private” / “Untrusted certificate” errors.

---

## 6. Troubleshooting

### Browser still shows certificate warnings

- Confirm that you generated the certificate with all hostnames/IPs you actually use. For example, if you visit `https://myserver.local` but only created a cert for `localhost`, it will not be trusted.
- Regenerate the certificate with all needed names, for example:

      mkcert myserver.local 192.168.1.42 localhost

- Ensure you imported the correct root CA (`rootCA.pem`) on macOS/iOS, and that it’s the same one used on the Pi.

### iOS says “Not Verified” or still warns

- Double-check that you:
  - Installed the downloaded profile.
  - Enabled full trust in **Settings → General → About → Certificate Trust Settings**.

### Chrome still doesn’t trust the certificate on macOS

- Make sure the CA was added to the **System** keychain (not just “login”).
- After changing trust settings, fully quit and restart Chrome.

---

## 7. Summary

You have now:

- Installed `mkcert` on your Raspberry Pi via APT.
- Created and installed a local CA on the Pi.
- Generated HTTPS certificates for your local server.
- Trusted the mkcert CA on:
  - macOS (Chrome and Safari)
  - iOS (Safari)

This gives you a secure, trusted HTTPS development environment for your Raspberry Pi that works smoothly across your local devices.
